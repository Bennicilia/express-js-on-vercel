api/yoco.js
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { token, amountInCents, currency } = req.body;

  if (!token || !amountInCents) {
    return res.status(400).json({ error: 'Missing payment details' });
  }

  try {
    const response = await fetch('https://online.yoco.com/v1/charges/', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.YOCO_SECRET_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        token,
        amountInCents,
        currency: currency || 'ZAR',
      }),
    });

    const data = await response.json();

    if (!response.ok) {
      return res.status(400).json({ error: data });
    }

    res.status(200).json({ success: true, charge: data });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Server error' });
  }
}
export default function handler(req, res) {
  if (req.method === "POST") {
    // Handle the webhook payload here
    res.status(200).json({ message: "Webhook received!" });
  } else {
    res.setHeader("Allow", ["POST"]);
    res.status(405).end(`Method ${req.method} Not Allowed`);
  }
}
export default function handler(req, res) {
  if (req.method === "POST") {
    // Handle the webhook logic here
    res.status(200).json({ message: "Webhook received!" });
  } else {
    res.status(405).json({ error: "Method Not Allowed" });
  }
}
npm install --save-dev webpack webpack-cli
npm install --save-dev webpack-cli
module.exports = async (req, res) => {
  const orderData = req.body;
  // You could now create an order in your DB, and send a Yoco payment link to the customer via email
  // Or respond with instructions, or even generate a unique HTML page with the Yoco widget for payment
  res.status(200).json({ message: "Order received. Payment to follow." });
};
api/jotform.js
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method Not Allowed' });
  }

  try {
    // 1️⃣ Get Jotform submission data
    const submission = req.body;
    console.log('Received Jotform data:', submission);

    // 2️⃣ Example: Extract customer name, amount, etc. (adjust names to match your form fields)
    const customerName = submission?.q3_name || 'Customer';
    const amountInCents = submission?.q5_amount * 100 || 5000; // example: R50.00

    // 3️⃣ Call Yoco API to create a payment link
    const response = await fetch('https://api.yoco.com/v1/charges/', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.YOCO_SECRET_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        amountInCents,
        currency: 'ZAR',
        description: `Order from ${customerName}`,
      }),
    });

    const data = await response.json();
    console.log('Yoco response:', data);

    // 4️⃣ Respond to Jotform or your frontend
    return res.status(200).json({
      success: true,
      message: 'Webhook received, Yoco payment created.',
      yocoResponse: data,
    });

  } catch (error) {
    console.error('Error handling webhook:', error);
    return res.status(500).json({ success: false, error: error.message });
  }
}
